#!  /usr/bin/env python3

import json
import os
import sys

#####

def main(argv):
    #   Don't buffer standard output.
    sys.stdout = os.fdopen(sys.stdout.fileno(), 'w', -1)

    #   In order to generate a list of regions that are configured in
    #   this account, pipe the output of aws ec2 describe-regions to
    #   this script, e.g.:
    #
    #   aws --output json ec2 describe-regions | \
    #       ./make-regions > regions.tf.json'.

    #   Load json object from standard inoput.
    obj = json.load(sys.stdin)

    #   Generate sorted list of known regions.
    region_list = sorted([ r['RegionName'] for r in obj['Regions'] ])

    known_regions_json = \
        {
        '//'     : 'This file generated by make-regions. DO NOT HAND-EDIT!',
        'locals' : dict(known_regions=region_list),
        }

    print(json.dumps(known_regions_json, indent=4))
    return 0

#####

if __name__ == '__main__':
    sys.exit(main(sys.argv))
